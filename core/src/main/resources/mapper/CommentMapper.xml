<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wiblog.mapper.CommentMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.wiblog.entity.Comment">
            <id column="id" property="id"/>
            <result column="uid" property="uid"/>
            <result column="article_id" property="articleId"/>
            <result column="gen_id" property="genId"/>
            <result column="parent_id" property="parentId"/>
            <result column="likes" property="likes"/>
            <result column="floor" property="floor"/>
            <result column="content" property="content"/>
            <result column="state" property="state"/>
            <result column="create_time" property="createTime"/>
            <result column="update_time" property="updateTime"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
id, uid, article_id, parent_id,gen_id,floor, likes, content, state,create_time, update_time
    </sql>
    
    <select id="selectCommentPage" resultType="com.wiblog.vo.CommentVo">
        select c.*,u.username,u.avatar_img as avatarImg from comment as c
        join user as u on u.uid = c.uid
        where c.article_id = #{articleId} and c.gen_id = 0
    </select>

    <select id="selectSubCommentLimit" resultType="com.wiblog.vo.SubCommentVo">
        select c1.*,
        u1.username as replyName,u1.avatar_img as replyAvatarImg,
        u2.uid as replyedId,u2.username as replyedName,u2.avatar_img as replyedAvatarImg
        from comment as c1
        join user as u1 on u1.uid = c1.uid and c1.gen_id = #{commentId}
        join comment as c2 on c2.id = c1.parent_id
        join user as u2 on u2.uid = c2.uid
        ORDER BY 'create_time' desc limit 3
    </select>
</mapper>