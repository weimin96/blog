<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wiblog.dao.UserMapper">
    <resultMap id="BaseResultMap" type="com.wiblog.model.User">
        <constructor>
            <idArg column="uid" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="phone" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="username" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="password" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="sex" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="email" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="avatar_img" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="create_time" jdbcType="TIMESTAMP" javaType="java.util.Date"/>
            <arg column="logged" jdbcType="TIMESTAMP" javaType="java.util.Date" />
        </constructor>
    </resultMap>
    <sql id="Base_Column_List">
    uid, phone, username, password, sex, email, avatar_img, create_time, logged
  </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        select
        <include refid="Base_Column_List"/>
        from user
        where uid = #{uid,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from user
    where uid = #{uid,jdbcType=INTEGER}
  </delete>
    <insert id="insert" parameterType="com.wiblog.model.User">
    insert into user (phone, username,
      password, sex, email, 
      avatar_img, create_time, logged
      )
    values (#{phone,jdbcType=VARCHAR}, #{username,jdbcType=VARCHAR},
      #{password,jdbcType=VARCHAR}, #{sex,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR}, 
      #{avatarImg,jdbcType=VARCHAR}, now(), #{logged,jdbcType=TIMESTAMP}
      )
  </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.wiblog.model.User">
        update user
        <set>
            <if test="phone != null">
                phone = #{phone,jdbcType=VARCHAR},
            </if>
            <if test="username != null">
                username = #{username,jdbcType=VARCHAR},
            </if>
            <if test="password != null">
                password = #{password,jdbcType=VARCHAR},
            </if>
            <if test="sex != null">
                sex = #{sex,jdbcType=VARCHAR},
            </if>
            <if test="email != null">
                email = #{email,jdbcType=VARCHAR},
            </if>
            <if test="avatarImg != null">
                avatar_img = #{avatarImg,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="logged != null">
                logged = #{logged,jdbcType=TIMESTAMP},
            </if>
        </set>
        where uid = #{uid,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.wiblog.model.User">
    update user
    set phone = #{phone,jdbcType=VARCHAR},
      username = #{username,jdbcType=VARCHAR},
      password = #{password,jdbcType=VARCHAR},
      sex = #{sex,jdbcType=VARCHAR},
      email = #{email,jdbcType=VARCHAR},
      avatar_img = #{avatarImg,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      logged = #{logged,jdbcType=TIMESTAMP}
    where uid = #{uid,jdbcType=INTEGER}
  </update>
    <select id="login" parameterType="com.wiblog.model.User" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM USER
        <where>
            <if test="username != null">
                username = #{username},
            </if>
            <if test="phone != null">
                phone = #{phone},
            </if>
            <if test="email != null">
                email = #{email},
            </if>
            and password = #{password}
        </where>
    </select>
    <select id="checkUsername" parameterType="string" resultType="java.lang.Integer">
    SELECT
    COUNT(*)
    FROM USER
    WHERE username=#{username}
  </select>
    <select id="checkPhone" parameterType="string" resultType="java.lang.Integer">
        SELECT
        COUNT(*)
        FROM USER
        WHERE phone=#{phone}
    </select>
    <select id="checkEmail" parameterType="string" resultType="java.lang.Integer">
        SELECT
        COUNT(*)
        FROM USER
        WHERE email=#{email}
    </select>
</mapper>